import React, { useState, useEffect, useRef } from 'react';
import classNames from 'classnames';
import { Link, NavLink, withRouter } from 'react-router-dom';
import { Link as AnimScrollTo } from 'react-scroll';
import LogoWhite from '../../images/logos/nav_logo_white.png';
import LogoColor from '../../images/logos/nav_logo_color_vertical.png';
import AccountPopOver from './AccountPopOver';
import { useSelector } from 'react-redux';
import Avatar from '../../images/avatar.png';
import styled from 'styled-components';

const StylePriceLink = styled.div`
    background-color: ${(props) => (props.defaultColor ? 'rgba(52, 51, 53, 0.73)' : 'rgba(196, 196, 196, 0.23)')};
    color: ${(props) => (props.defaultColor ? 'rgba(239, 239, 239, 1)' : '#e8e8e8;')};

    margin-left: 20px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 11px;
    font-size: 11px;
    font-weight: 500;
    padding: 0 14px;

    & > svg {
        margin-right: 10px;
    }
`;

const MainHeader = styled.div`
    max-width: 1216px;
    margin: 0 auto;

    & .header {
        height: 80px;
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 27px;

        & .icon {
            display: flex;
            flex-direction: row;
            align-items: center;
            width: 65px;
            height: 36px;
            cursor: pointer;

            & a {
                font-weight: bold;
                color: #6c46a1;
                font-size: 16px;
                letter-spacing: -0.02em;
                margin: 0px 8px;
                padding: 8px 16px;
                border-radius: 104px;
                background: #f4f1fa;
            }
        }
        & .plan {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            & .purchase {
                display: flex;
                margin-right: 8px;
                flex-direction: row;
                align-items: center;
                justify-content: center;
                width: 128px;
                height: 36px;
                background: #6c46a1;
                border-radius: 104px;
                color: #ffffff;
                font-weight: bold;
                font-size: 16px;
                text-align: center;
            }
            & .profile {
                & .profileImage {
                    width: 40px;
                    height: 40px;
                    border-radius: 50%;
                }
            }
            & p {
                margin: 0px 8px;
            }
        }
    }
`;
const StyleHeader = styled.header`
    background-color: ${(props) => (props.defaultColor ? props.defaultColor : 'transparent')};
    color: ${(props) => (props.defaultColor ? 'black' : '#ffffff;')};
`;

const useScroll = () => {
    // state를 생성합니다.
    const [state, setState] = useState({
        x: 0,
        y: 0,
    });

    // scrll의 값을 가져와 state를 갱신합니다.
    const onScroll = () => {
        setState({ y: window.scrollY, x: window.scrollX });
    };
    useEffect(() => {
        // scroll 이벤트를 만들어줍니다. 스크롤을 움직일때 마다
        // onScroll 함수가 실행됩니다.
        window.addEventListener('scroll', onScroll);
        return () => window.removeEventListener('scroll', onScroll);
    }, []);
    return state;
};

function HeaderBar({ match, defaultColor }) {
    const sessions = useSelector((state) => state.RdxSessions);
    const [popoverName, setPopoverName] = useState('');
    const testRef = useRef();

    const { y } = useScroll();

    useEffect(() => {
        setPopoverName(sessions.userName);
    }, [sessions.userName]);

    return (
        <>
            <MainHeader>
                <div className="header">
                    <div className="altrid">
                        <Link to="/">
                            <svg width="161" height="40" viewBox="0 0 161 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M33.1277 36.0909L17.7536 11.064L2.36967 36.1488C1.98609 36.1828 1.62107 36.3257 1.31952 36.5598C1.01797 36.7939 0.793056 37.1091 0.672492 37.4665C0.551928 37.8239 0.540956 38.208 0.640942 38.5714C0.740928 38.9349 0.947511 39.2618 1.23524 39.512C1.52296 39.7622 1.87927 39.9247 2.26032 39.9795C2.64137 40.0344 3.03051 39.9791 3.37984 39.8206C3.72917 39.6621 4.02344 39.4073 4.22641 39.0874C4.42939 38.7676 4.53225 38.3967 4.52227 38.0205C4.52111 37.7056 4.43603 37.3963 4.27541 37.1233L7.48452 31.923C10.4914 33.989 14.0777 35.0977 17.7536 35.0977C21.4296 35.0977 25.0159 33.989 28.0228 31.923L31.2516 37.1812C31.0567 37.5507 30.9891 37.972 31.059 38.3821C31.1289 38.7922 31.3325 39.1694 31.6395 39.4573C31.9465 39.7452 32.3405 39.9285 32.7628 39.9799C33.185 40.0314 33.613 39.9482 33.9829 39.7427C34.3529 39.5372 34.645 39.2205 34.8158 38.8397C34.9866 38.4588 35.0269 38.0343 34.9308 37.6293C34.8347 37.2242 34.6072 36.8604 34.2823 36.5919C33.9574 36.3233 33.5525 36.1646 33.1277 36.1392V36.0909ZM2.59679 38.4643C2.46323 38.4643 2.33514 38.4125 2.2407 38.3202C2.14626 38.2279 2.0932 38.1028 2.0932 37.9723C2.07851 37.9009 2.08023 37.8272 2.09823 37.7565C2.11624 37.6858 2.15008 37.6199 2.19731 37.5635C2.24454 37.5072 2.30402 37.4618 2.37139 37.4306C2.43877 37.3994 2.51236 37.3833 2.58691 37.3833C2.66145 37.3833 2.73508 37.3994 2.80245 37.4306C2.86983 37.4618 2.92927 37.5072 2.9765 37.5635C3.02374 37.6199 3.05758 37.6858 3.07558 37.7565C3.09359 37.8272 3.09531 37.9009 3.08062 37.9723C3.08072 38.0995 3.0304 38.2218 2.94019 38.3136C2.84998 38.4053 2.7269 38.4594 2.59679 38.4643ZM17.7734 32.9457C14.4878 32.9386 11.2869 31.9265 8.62004 30.0513L17.7734 15.1547L26.9268 30.0416C24.2574 31.9276 21.0477 32.9438 17.7536 32.9457H17.7734ZM32.9994 38.4643C32.8658 38.4643 32.7377 38.4125 32.6433 38.3202C32.5488 38.2279 32.4958 38.1028 32.4958 37.9723C32.4811 37.9009 32.4828 37.8272 32.5008 37.7565C32.5188 37.6858 32.5526 37.6199 32.5999 37.5635C32.6471 37.5072 32.7066 37.4618 32.7739 37.4306C32.8413 37.3994 32.9149 37.3833 32.9895 37.3833C33.064 37.3833 33.1376 37.3994 33.205 37.4306C33.2724 37.4618 33.3318 37.5072 33.3791 37.5635C33.4263 37.6199 33.4602 37.6858 33.4782 37.7565C33.4962 37.8272 33.4979 37.9009 33.4832 37.9723C33.4832 38.1028 33.4301 38.2279 33.3357 38.3202C33.2412 38.4125 33.1132 38.4643 32.9796 38.4643H32.9994Z"
                                    fill="url(#paint0_linear_48:469)"
                                />
                                <path
                                    d="M2.21978 27.2047C2.17031 27.4845 2.18324 27.7715 2.25766 28.0458C2.33209 28.32 2.46621 28.5748 2.6506 28.7923C2.83498 29.0097 3.06518 29.1846 3.32502 29.3045C3.58486 29.4245 3.86804 29.4866 4.15471 29.4866C4.44137 29.4866 4.72456 29.4245 4.9844 29.3045C5.24423 29.1846 5.47443 29.0097 5.65882 28.7923C5.8432 28.5748 5.97732 28.32 6.05175 28.0458C6.12617 27.7715 6.1391 27.4845 6.08964 27.2047C6.08617 26.9243 6.01902 26.6483 5.89319 26.3971L17.7876 7.04353L29.6722 26.3777C29.5429 26.6311 29.4756 26.9111 29.4758 27.195C29.4219 27.4763 29.4314 27.7658 29.5035 28.0431C29.5756 28.3203 29.7086 28.5783 29.8929 28.7988C30.0772 29.0193 30.3084 29.1967 30.5699 29.3186C30.8314 29.4404 31.1168 29.5035 31.4058 29.5035C31.6947 29.5035 31.9802 29.4404 32.2417 29.3186C32.5032 29.1967 32.7343 29.0193 32.9187 28.7988C33.103 28.5783 33.2359 28.3203 33.308 28.0431C33.3801 27.7658 33.3896 27.4763 33.3358 27.195C33.3364 26.9299 33.2795 26.6677 33.1688 26.4263C34.7311 23.7491 35.5542 20.7116 35.5556 17.6192C35.5569 14.5269 34.7362 11.4887 33.1763 8.81019C31.6163 6.1317 29.3719 3.90732 26.6688 2.36077C23.9657 0.814214 20.8993 0 17.7778 0C14.6563 0 11.5898 0.814214 8.88675 2.36077C6.18367 3.90732 3.93929 6.1317 2.3793 8.81019C0.819309 11.4887 -0.00130671 14.5269 1.56185e-06 17.6192C0.00130984 20.7116 0.824507 23.7491 2.38676 26.4263C2.2794 26.6722 2.22262 26.9368 2.21978 27.2047ZM4.18417 27.701C4.10456 27.7003 4.02631 27.6805 3.95616 27.6432C3.886 27.6059 3.82605 27.5523 3.78147 27.4869C3.71845 27.406 3.68394 27.3069 3.68324 27.2047C3.68324 27.0731 3.73602 26.9469 3.82997 26.8538C3.92391 26.7608 4.05132 26.7085 4.18417 26.7085C4.26378 26.7092 4.34203 26.729 4.41219 26.7663C4.48234 26.8036 4.54229 26.8572 4.58688 26.9226C4.64213 26.9955 4.67557 27.0824 4.68339 27.1732C4.69122 27.2641 4.6731 27.3553 4.63112 27.4365C4.58913 27.5176 4.52496 27.5855 4.44594 27.6322C4.36691 27.679 4.27621 27.7028 4.18417 27.701ZM31.4401 27.701C31.3267 27.6784 31.2246 27.6176 31.1513 27.5289C31.078 27.4402 31.0379 27.3291 31.0379 27.2145C31.0379 27.0998 31.078 26.9887 31.1513 26.9C31.2246 26.8113 31.3267 26.7505 31.4401 26.728C31.5128 26.7135 31.5879 26.7152 31.6598 26.7329C31.7318 26.7507 31.7989 26.784 31.8562 26.8305C31.9136 26.8771 31.9598 26.9357 31.9916 27.0021C32.0233 27.0685 32.0398 27.141 32.0398 27.2145C32.0398 27.2879 32.0233 27.3605 31.9916 27.4269C31.9598 27.4932 31.9136 27.5518 31.8562 27.5984C31.7989 27.6449 31.7318 27.6783 31.6598 27.696C31.5879 27.7138 31.5128 27.7155 31.4401 27.701ZM2.15102 17.6204C2.14516 15.2513 2.6879 12.9124 3.73749 10.7836C4.78709 8.65489 6.31557 6.793 8.20537 5.34119C10.0952 3.88938 12.2959 2.88632 14.6384 2.40919C16.9808 1.93205 19.4025 1.99354 21.7172 2.58893C24.0319 3.18431 26.1779 4.29773 27.9901 5.84355C29.8024 7.38936 31.2326 9.32637 32.1707 11.5056C33.1089 13.6848 33.53 16.0482 33.4016 18.4139C33.2732 20.7796 32.5988 23.0846 31.4303 25.1516L17.7876 2.93735L4.13507 25.1516C2.83217 22.8515 2.14888 20.2579 2.15102 17.6204Z"
                                    fill="url(#paint1_linear_48:469)"
                                />
                                <path
                                    d="M44.9958 33.2259L47.6441 25.7845H58.2888L60.9371 33.2259H64.2796L54.612 6.9502H51.3209L41.6533 33.2259H44.9958ZM48.6469 22.9619L52.8636 11.1071H53.0693L57.286 22.9619H48.6469Z"
                                    fill="black"
                                />
                                <path d="M67.6566 33.2259H83.0836V30.4033H70.8448V6.9502H67.6566V33.2259Z" fill="black" />
                                <path d="M82.3563 9.77278H90.6355V33.2259H93.8237V9.77278H102.103V6.9502H82.3563V9.77278Z" fill="black" />
                                <path
                                    d="M105.399 33.2259H110.966V23.9113H115.029L120.017 33.2259H126.162L120.569 23.0132C123.565 21.7303 125.223 19.1258 125.223 15.5334C125.223 10.3116 121.765 6.9502 115.787 6.9502H105.399V33.2259ZM110.966 19.4465V11.492H114.72C117.934 11.492 119.489 12.9161 119.489 15.5334C119.489 18.1379 117.934 19.4465 114.746 19.4465H110.966Z"
                                    fill="black"
                                />
                                <path d="M134 6.9502H128.433V33.2259H134V6.9502Z" fill="black" />
                                <path
                                    d="M147.189 33.2259C155.211 33.2259 160.07 28.2735 160.07 20.0624C160.07 11.8769 155.211 6.9502 147.266 6.9502H137.855V33.2259H147.189ZM143.422 28.466V11.7101H146.97C151.907 11.7101 154.517 14.2248 154.517 20.0624C154.517 25.9256 151.907 28.466 146.957 28.466H143.422Z"
                                    fill="black"
                                />
                                <defs>
                                    <linearGradient
                                        id="paint0_linear_48:469"
                                        x1="17.7833"
                                        y1="0.557271"
                                        x2="17.7833"
                                        y2="32.8588"
                                        gradientUnits="userSpaceOnUse"
                                    >
                                        <stop stopColor="#51BA97" />
                                        <stop offset="1" stopColor="#47278B" />
                                    </linearGradient>
                                    <linearGradient
                                        id="paint1_linear_48:469"
                                        x1="14625.8"
                                        y1="3315.31"
                                        x2="14625.8"
                                        y2="4303.09"
                                        gradientUnits="userSpaceOnUse"
                                    >
                                        <stop stopColor="#51BA97" />
                                        <stop offset="1" stopColor="#47278B" />
                                    </linearGradient>
                                </defs>
                            </svg>
                        </Link>
                    </div>

                    <div className="icon">
                        <Link to="/">클래스</Link>
                        <Link to="/main-draft">과제</Link>
                    </div>

                    <div className="plan">
                        <div className="purchase">
                            <svg width="12" height="10" viewBox="0 0 12 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M7.5 3.09235e-06C7.85114 -3.86887e-05 8.19611 0.0923691 8.50021 0.267935C8.80431 0.443501 9.05683 0.696037 9.23237 1.00015C9.40792 1.30426 9.5003 1.64923 9.50024 2.00038C9.50017 2.35152 9.40766 2.69646 9.232 3.0005L11.5 3V4H10.5V9C10.5 9.13261 10.4473 9.25979 10.3536 9.35356C10.2598 9.44732 10.1326 9.5 10 9.5H2C1.86739 9.5 1.74021 9.44732 1.64645 9.35356C1.55268 9.25979 1.5 9.13261 1.5 9V4H0.5V3L2.768 3.0005C2.51993 2.57095 2.44034 2.06453 2.54469 1.57959C2.64904 1.09465 2.92987 0.665787 3.33267 0.376279C3.73546 0.0867716 4.23147 -0.0427221 4.72437 0.0129424C5.21728 0.0686069 5.67192 0.305457 6 0.677503C6.1873 0.464194 6.41803 0.29339 6.67673 0.176542C6.93544 0.0596942 7.21613 -0.000497124 7.5 3.09235e-06ZM6.5 4H5.5V9H6.5V4ZM4.5 1C4.24051 0.998842 3.99073 1.0986 3.80342 1.27819C3.61612 1.45779 3.50597 1.70316 3.49623 1.96247C3.48649 2.22178 3.57794 2.47473 3.75125 2.66786C3.92455 2.861 4.16615 2.9792 4.425 2.9975L4.5 3H5.5V2C5.50001 1.76103 5.41444 1.52996 5.2588 1.34863C5.10315 1.1673 4.88771 1.04771 4.6515 1.0115L4.5745 1.0025L4.5 1ZM7.5 1C7.24771 0.999923 7.00472 1.09521 6.81973 1.26675C6.63474 1.4383 6.52142 1.67343 6.5025 1.925L6.5 2V3H7.5C7.75229 3.00008 7.99528 2.9048 8.18027 2.73325C8.36526 2.56171 8.47858 2.32658 8.4975 2.075L8.5 2C8.5 1.73479 8.39464 1.48043 8.20711 1.2929C8.01957 1.10536 7.76522 1 7.5 1Z"
                                    fill="white"
                                />
                            </svg>

                            <p>이용권 구매</p>
                        </div>
                        <div className="profile" ref={testRef} style={{ display: 'flex' }}>
                            {sessions.image ? (
                                <div className="profileImage">
                                    <img
                                        style={{
                                            borderRadius: '50%',
                                            width: '40px',
                                            height: '40px',
                                        }}
                                        src={sessions.image}
                                        alt="profileimage"
                                    />
                                </div>
                            ) : (
                                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect width="40" height="40" rx="16" fill="#F4F1FA" />
                                    <path
                                        d="M14.6665 26.6665C14.6665 25.252 15.2284 23.8955 16.2286 22.8953C17.2288 21.8951 18.5853 21.3332 19.9998 21.3332C21.4143 21.3332 22.7709 21.8951 23.7711 22.8953C24.7713 23.8955 25.3332 25.252 25.3332 26.6665H14.6665ZM19.9998 20.6665C17.7898 20.6665 15.9998 18.8765 15.9998 16.6665C15.9998 14.4565 17.7898 12.6665 19.9998 12.6665C22.2098 12.6665 23.9998 14.4565 23.9998 16.6665C23.9998 18.8765 22.2098 20.6665 19.9998 20.6665Z"
                                        fill="#3B1689"
                                    />
                                </svg>
                            )}

                            <AccountPopOver userName={sessions.userName} image={sessions.image} targetEl={testRef ? testRef : null} />
                        </div>
                    </div>
                </div>
            </MainHeader>
        </>
    );
}

export default React.memo(withRouter(HeaderBar));
